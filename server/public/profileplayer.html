<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Player Profile</title>

  <!-- Bootstrap CSS and JS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <!-- jQuery -->
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>

  <style>
    body {
      background: linear-gradient(120deg, #23243a 50%, #3a4a73 100%);
      min-height: 100vh;
      color: #223055;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    .profile-card {
      max-width: 700px;
      margin: 3rem auto;
      background: #fff;
      border-radius: 1rem;
      box-shadow: 0 4px 28px rgba(50, 60, 120, 0.15);
      padding: 2.2rem 2rem;
    }
    .form-label {
      font-weight: 600;
    }
    .image-preview {
      border: 1px solid #eee;
      border-radius: 10px;
      width: 100px;
      height: 100px;
      object-fit: cover;
      display: block;
      margin: 0.7rem auto;
      background: #ececec;
    }
  </style>

  <script>
    // Image preview when file selected
    function preview(event) {
      if (event.target.files.length > 0) {
        document.getElementById('prev').src = URL.createObjectURL(event.target.files[0]);
      }
    }

    $(document).ready(function () {
      // Prefill email if stored in localStorage, allow editing
      const activeUser = localStorage.getItem("activeuser");
      if (activeUser) {
        $("#txtemail").val(activeUser);
      }

      // Fetch user details on Search button click
      $("#btnFetch").click(function (e) {
        e.preventDefault();
        let email = $("#txtemail").val();
        if (!email) {
          alert("Please enter an email to search.");
          $("#txtemail").focus();
          return;
        }
        $.ajax({
          type: "get",
          url: "/fetch-user",
          data: { txtemail: email }
        })
          .done(function (responseAry) {
            if (responseAry.length === 0) {
              alert("No user found with this email.");
              return;
            }
            const data = responseAry[0];
            const dob = data.dob.split("T")[0];
            $("#txtname").val(data.name);
            $("#txtgender").val(data.gender);
            $("#txtdate").val(dob);
            $("#txtcontact").val(data.contact);
            $("#txtaddress").val(data.address);
            $("#txtcity").val(data.city);
            $("#proof").val(data.proof);
            $("#prev").prop("src", data.pic || "pics/user.jpg");
            $("#txtsports").val(data.sports);
            $("#txtachievements").val(data.achievements);
          })
          .fail(function () {
            alert("Error fetching data. Please try again.");
          });
      });

      // Enable Bootstrap 5 validation styles
      (function () {
        'use strict';
        var forms = document.querySelectorAll('.needs-validation');
        Array.prototype.slice.call(forms).forEach(function (form) {
          form.addEventListener('submit', function (event) {
            if (!form.checkValidity()) {
              event.preventDefault();
              event.stopPropagation();
            }
            form.classList.add('was-validated');
          }, false);
        });
      })();
    });
  </script>
</head>
<body>
  <div class="profile-card">
    <h2 class="text-center fw-bold mb-4" style="color: #0d6efd">Player Profile</h2>
    <form class="needs-validation" novalidate method="post" enctype="multipart/form-data">

      <!-- Email + Search -->
      <div class="row mb-3">
        <div class="col-md-8">
          <label for="txtemail" class="form-label">Email</label>
          <input
            type="email"
            class="form-control"
            name="txtemail"
            id="txtemail"
            placeholder="Enter your email"
            pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,}$"
            title="Please enter a valid email address, e.g., user@example.com"
            required
          />
          <div class="invalid-feedback">
            Please provide a valid email address (must include @ and domain, e.g., .com).
          </div>
        </div>
        <div class="col-md-4 d-flex align-items-end">
          <button type="button" class="btn btn-primary w-100" id="btnFetch">Search</button>
        </div>
      </div>

      <!-- Name, Gender -->
      <div class="row mb-3">
        <div class="col-md-6">
          <label for="txtname" class="form-label">Name</label>
          <input
            type="text"
            class="form-control"
            id="txtname"
            name="txtname"
            placeholder="Enter your full name"
            required
          />
          <div class="invalid-feedback">
            Please enter your name.
          </div>
        </div>
        <div class="col-md-6">
          <label for="txtgender" class="form-label">Gender</label>
          <select class="form-select" name="txtgender" id="txtgender" required>
            <option value="" disabled selected>Select gender</option>
            <option>Male</option>
            <option>Female</option>
            <option>Other</option>
          </select>
          <div class="invalid-feedback">Please select your gender.</div>
        </div>
      </div>

      <!-- DOB, Contact Number -->
      <div class="row mb-3">
        <div class="col-md-6">
          <label for="txtdate" class="form-label">Date of Birth</label>
          <input
            type="date"
            class="form-control"
            id="txtdate"
            name="txtdate"
            required
          />
          <div class="invalid-feedback">Please enter your date of birth.</div>
        </div>
        <div class="col-md-6">
          <label for="txtcontact" class="form-label">Contact Number</label>
          <input
            type="tel"
            class="form-control"
            id="txtcontact"
            name="txtcontact"
            pattern="^\d{10,15}$"
            placeholder="Enter 10-15 digit phone number"
            required
          />
          <div class="invalid-feedback">Please enter a valid contact number (digits only).</div>
        </div>
      </div>

      <!-- Address and City -->
      <div class="row mb-3">
        <div class="col-md-8">
          <label for="txtaddress" class="form-label">Address</label>
          <input
            type="text"
            class="form-control"
            id="txtaddress"
            name="txtaddress"
            placeholder="Enter your address"
            required
          />
          <div class="invalid-feedback">Please enter your address.</div>
        </div>
        <div class="col-md-4">
          <label for="txtcity" class="form-label">City</label>
          <input
            type="text"
            class="form-control"
            id="txtcity"
            name="txtcity"
            placeholder="Enter your city"
            required
          />
          <div class="invalid-feedback">Please enter your city.</div>
        </div>
      </div>

      <!-- ID Proof, Upload Picture -->
      <div class="row mb-4">
        <div class="col-md-6">
          <label for="proof" class="form-label">ID Proof</label>
          <select class="form-select" name="proof" id="proof" required>
            <option value="" disabled selected>Select ID Proof</option>
            <option>PAN Card</option>
            <option>Aadhaar Card (Individual)</option>
            <option>Passport</option>
          </select>
          <div class="invalid-feedback">Please select an ID proof.</div>
        </div>
        <div class="col-md-6 text-center">
          <label class="form-label">Upload Profile Picture</label>
          <input
            type="file"
            accept="image/*"
            class="form-control"
            name="picupload"
            onchange="preview(event)"
          />
          <img src="pics/user.jpg" alt="Image Preview" id="prev" class="image-preview" />
        </div>
      </div>

      <!-- Sports and Achievements -->
      <div class="mb-3">
        <label for="txtsports" class="form-label">Sports</label>
        <textarea
          name="txtsports"
          id="txtsports"
          class="form-control"
          rows="2"
          placeholder="Enter sports you play"
          required
        ></textarea>
        <div class="invalid-feedback">Please enter at least one sport.</div>
      </div>

      <div class="mb-4">
        <label for="txtachievements" class="form-label">Other Achievements</label>
        <textarea
          name="txtachievements"
          id="txtachievements"
          class="form-control"
          rows="2"
          placeholder="Enter any other achievements"
        ></textarea>
      </div>

      <!-- Buttons -->
      <div class="d-flex gap-3 justify-content-center mb-3">
        <button type="submit" class="btn btn-primary px-5" formaction="/profile-player">
          Send to Server
        </button>
        <button type="submit" class="btn btn-outline-primary px-5" formaction="/update-player">
          Modify
        </button>
      </div>
    </form>
  </div>

  <footer class="mt-5 py-3 text-center small" style="color: #96c9eb;">
    &copy; 2025 PulseForge. All rights reserved.
  </footer>
</body>
</html>
